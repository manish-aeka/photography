<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloudinary Upload Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-900 min-h-screen flex items-center justify-center p-8">
    <div class="max-w-2xl w-full bg-gray-800 rounded-xl shadow-2xl p-8">
        <h1 class="text-3xl font-bold text-white mb-6 text-center">
            üå•Ô∏è Cloudinary Upload Test
        </h1>

        <!-- Configuration Status -->
        <div id="configStatus" class="mb-6 p-4 rounded-lg bg-yellow-500/20 border border-yellow-500">
            <p class="text-yellow-300 font-semibold">‚ö†Ô∏è Configuration Required</p>
            <p class="text-yellow-200 text-sm mt-1">
                Please update cloudinary-uploader.js with your credentials
            </p>
        </div>

        <!-- File Input -->
        <div class="mb-6">
            <label class="block text-gray-300 font-semibold mb-2">Select Image:</label>
            <input type="file" id="fileInput" accept="image/*"
                class="w-full px-4 py-3 bg-gray-700 text-white rounded-lg border-2 border-gray-600 focus:border-blue-500 focus:outline-none">
        </div>

        <!-- Upload Button -->
        <button onclick="testUpload()"
            class="w-full bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white font-bold py-4 rounded-lg transition-all shadow-lg">
            Upload to Cloudinary
        </button>

        <!-- Progress Bar -->
        <div id="progressContainer" class="mt-6 hidden">
            <div class="bg-gray-700 rounded-lg overflow-hidden mb-2">
                <div id="progressBar"
                    class="bg-blue-500 h-8 flex items-center justify-center text-white font-bold transition-all duration-300"
                    style="width: 0%">
                    0%
                </div>
            </div>
            <p id="progressText" class="text-gray-300 text-center"></p>
        </div>

        <!-- Result -->
        <div id="resultContainer" class="mt-6 hidden">
            <h3 class="text-xl font-bold text-white mb-3">Upload Result:</h3>
            <div class="bg-gray-700 rounded-lg p-4">
                <pre id="resultJSON" class="text-green-400 text-sm overflow-auto max-h-64"></pre>
            </div>
            <div id="imagePreview" class="mt-4 hidden">
                <img id="uploadedImage" src="" alt="Uploaded" class="w-full rounded-lg shadow-lg">
            </div>
        </div>
    </div>

    <!-- Cloudinary Uploader Script -->
    <script src="./cloudinary-uploader.js"></script>

    <script>
        // Check configuration
        window.addEventListener('load', () => {
            const configStatus = document.getElementById('configStatus');
            if (cloudinaryUploader.cloudName !== 'YOUR_CLOUD_NAME' &&
                cloudinaryUploader.uploadPreset !== 'YOUR_UNSIGNED_PRESET') {
                configStatus.innerHTML = `
                    <p class="text-green-300 font-semibold">‚úÖ Configuration Detected</p>
                    <p class="text-green-200 text-sm mt-1">
                        Cloud: ${cloudinaryUploader.cloudName} | Preset: ${cloudinaryUploader.uploadPreset}
                    </p>
                `;
                configStatus.className = 'mb-6 p-4 rounded-lg bg-green-500/20 border border-green-500';
            }
        });

        async function testUpload() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];

            if (!file) {
                alert('Please select an image first!');
                return;
            }

            // Validate configuration
            if (cloudinaryUploader.cloudName === 'YOUR_CLOUD_NAME') {
                alert('Please update cloudinary-uploader.js with your Cloudinary credentials!\n\nSee CLOUDINARY_SETUP.md for instructions.');
                return;
            }

            // Validate file
            const validation = cloudinaryUploader.validateFile(file);
            if (!validation.valid) {
                alert('Validation Error: ' + validation.error);
                return;
            }

            // Show progress
            const progressContainer = document.getElementById('progressContainer');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const resultContainer = document.getElementById('resultContainer');

            progressContainer.classList.remove('hidden');
            resultContainer.classList.add('hidden');
            progressText.textContent = 'Starting upload...';

            try {
                // Upload with progress tracking
                const result = await cloudinaryUploader.upload(file, (percentage) => {
                    progressBar.style.width = percentage + '%';
                    progressBar.textContent = percentage + '%';
                    progressText.textContent = `Uploading... ${percentage}%`;
                });

                // Show result
                if (result.success) {
                    progressBar.classList.add('bg-green-500');
                    progressBar.style.width = '100%';
                    progressBar.textContent = '100%';
                    progressText.textContent = '‚úÖ Upload Complete!';

                    setTimeout(() => {
                        progressContainer.classList.add('hidden');
                        resultContainer.classList.remove('hidden');

                        document.getElementById('resultJSON').textContent = JSON.stringify(result, null, 2);

                        const imagePreview = document.getElementById('imagePreview');
                        const uploadedImage = document.getElementById('uploadedImage');
                        uploadedImage.src = result.url;
                        imagePreview.classList.remove('hidden');
                    }, 1000);
                } else {
                    throw new Error(result.error || 'Upload failed');
                }

            } catch (error) {
                progressBar.classList.add('bg-red-500');
                progressText.textContent = '‚ùå Upload Failed: ' + error.message;
                console.error('Upload error:', error);

                setTimeout(() => {
                    progressContainer.classList.add('hidden');
                    progressBar.classList.remove('bg-red-500');
                    progressBar.style.width = '0%';
                }, 3000);
            }
        }

        // Allow drag and drop
        const fileInput = document.getElementById('fileInput');

        document.addEventListener('dragover', (e) => {
            e.preventDefault();
        });

        document.addEventListener('drop', (e) => {
            e.preventDefault();
            const files = e.dataTransfer.files;
            if (files.length > 0 && files[0].type.startsWith('image/')) {
                fileInput.files = files;
            }
        });
    </script>
</body>

</html>